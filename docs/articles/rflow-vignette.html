<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to rflow • rflow</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to rflow">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rflow</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.5.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/rflow-vignette.html">Introduction to rflow</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/numeract/rflow">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to rflow</h1>
                        <h4 class="author">Numeract LLC</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/numeract/rflow/blob/master/vignettes/rflow-vignette.Rmd"><code>vignettes/rflow-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>rflow-vignette.Rmd</code></div>

    </div>

    
    
<p>rflow is a package that allows cacheing of functions in memory, on disk or in both memory and disk.</p>
<div id="problems-addressed-by-rflow" class="section level2">
<h2 class="hasAnchor">
<a href="#problems-addressed-by-rflow" class="anchor"></a>Problems addressed by rflow</h2>
<p>A common problem when processing data as part of a pipeline is avoiding unnecessary calculations. For example, if a function is called over and over with the same arguments, it should not recalculate the result each time but it should provide the cached (pre-computed) result.</p>
<p>While caching of the function output resolves the first problem, a second issue occurs when large data sets are being processed. In this case, hashing of the input arguments each time might take too long. This issue can be solved by hashing the data only once (as output) and then by noticing changes in the hash received by the downstream function. In other words, it is not the data that flows through the pipeline (as is the case with standard function), but hashes of the data.</p>
<p>A third issue is output sub-setting. When working with a pipeline there is often the case (e.g. ETL, Machine Learning) that we need to pass the whole data frame but the function is going to use only a subset (e.g. a CV fold). Since the main data frame has changes, caching of the result is no longer efficient. The solution involves hashing of the subset of interest which can be done by introducing additional intermediate functions in the pipeline. However, there is a loss of efficiency due to excessive rehashing as the main data frame passes through many functions.</p>
<p>The package rflow addresses these inefficiencies and makes pipelines as easy to use as in tidyverse.</p>
</div>
<div id="basics" class="section level2">
<h2 class="hasAnchor">
<a href="#basics" class="anchor"></a>Basics</h2>
<p>Here’s how a simple rflow pipeline works with functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rflow)

x1 &lt;-<span class="st"> </span><span class="dv">10</span>
x2 &lt;-<span class="st"> </span><span class="fl">0.5</span>
x3 &lt;-<span class="st"> </span><span class="dv">2</span>

f1 &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, <span class="dt">c =</span> <span class="dv">1</span>) {a <span class="op">*</span><span class="st"> </span>b <span class="op">+</span><span class="st"> </span>c}
f2 &lt;-<span class="st"> </span><span class="cf">function</span>(d, e) {d <span class="op">/</span><span class="st"> </span>e}

<span class="co"># passing the results downstream using functions</span>
(o1 &lt;-<span class="st"> </span><span class="kw">f1</span>(x1, x2))  
<span class="co">#&gt; [1] 6</span>
(o2 &lt;-<span class="st"> </span><span class="kw">f2</span>(o1, x3)) 
<span class="co">#&gt; [1] 3</span>


<span class="co"># variant 1: declaring flows for each function using default options</span>
rf1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flow_fn.html">flow_fn</a></span>(x1, x2, <span class="dt">fn =</span> f1)
rf2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flow_fn.html">flow_fn</a></span>(rf1, x3, <span class="dt">fn =</span> f2)

<span class="co"># collecting the results</span>
<span class="kw"><a href="../reference/collect.R6Flow.html">collect</a></span>(rf1)         
<span class="co">#&gt; [1] 6</span>
<span class="kw"><a href="../reference/collect.R6Flow.html">collect</a></span>(rf2)         
<span class="co">#&gt; [1] 3</span>


<span class="co"># variant 2: arguments and functions withing one call</span>
<span class="kw">library</span>(dplyr)                          <span class="co"># makes life easier </span>
<span class="kw"><a href="../reference/flow_fn.html">flow_fn</a></span>(x1, x2, <span class="dt">fn =</span> f1) <span class="op">%&gt;%</span><span class="st">            </span><span class="co"># reuses cache created by ff1</span>
<span class="st">  </span><span class="kw"><a href="../reference/flow_fn.html">flow_fn</a></span>(x3, <span class="dt">fn =</span> f2) <span class="op">%&gt;%</span><span class="st">              </span><span class="co"># reuses cache created by ff2</span>
<span class="st">  </span><span class="kw"><a href="../reference/collect.R6Flow.html">collect</a></span>()                             <span class="co"># no actual re-calc takes place</span>
<span class="co">#&gt; [1] 3</span></code></pre></div>
</div>
<div id="eddy-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#eddy-functions" class="anchor"></a>Eddy functions</h2>
<p>An <code>eddy</code> is a <code>R6</code> object in which the rflow data is stored. It also contains information regarding the type of cache (memory, file or file-memory) used. Once an eddy is set, all data from the flows created afterwards is kept in it implicitly. Examples of eddy functions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rflow)

<span class="co"># create a new eddy</span>
<span class="kw"><a href="../reference/new_eddy.html">new_eddy</a></span>(<span class="st">"new_eddy_example"</span>)
<span class="kw"><a href="../reference/get_eddy.html">get_eddy</a></span>(<span class="st">"new_eddy_example"</span>)

<span class="co"># set "new_eddy_example" as current</span>
<span class="kw"><a href="../reference/set_current_eddy.html">set_current_eddy</a></span>(<span class="st">"new_eddy_example"</span>)

<span class="co"># the eddy used to store flowed_fn data will be "new_eddy_example"</span>
fn &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) { x <span class="op">+</span><span class="st"> </span>y }
flowed_fn &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flow_fn.html">flow_fn</a></span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dt">fn =</span> fn)

<span class="co"># creates a new eddy or re-uses it if present</span>
<span class="kw"><a href="../reference/use_eddy.html">use_eddy</a></span>(<span class="st">"use_eddy"</span>)

<span class="co"># the eddy used to store flowed_fn data will now be "use_eddy"</span>
fn &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) { x <span class="op">+</span><span class="st"> </span>y }
flowed_fn &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flow_fn.html">flow_fn</a></span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dt">fn =</span> fn)

<span class="kw"><a href="../reference/delete_eddy.html">delete_eddy</a></span>(<span class="st">"use_eddy"</span>)

<span class="co"># set the eddy to be used in future flow calls</span>
<span class="kw"><a href="../reference/set_current_eddy.html">set_current_eddy</a></span>(<span class="st">"new_eddy_example"</span>)
<span class="kw"><a href="../reference/get_current_eddy.html">get_current_eddy</a></span>()

<span class="co"># notice the message received due to creating a flow with the same function</span>
<span class="co"># and the same arguments in "new_eddy_example"</span>
fn &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) { x <span class="op">+</span><span class="st"> </span>y }
flowed_fn &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flow_fn.html">flow_fn</a></span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dt">fn =</span> fn)

<span class="co"># remove the eddy object</span>
<span class="kw"><a href="../reference/delete_eddy.html">delete_eddy</a></span>(<span class="st">"new_eddy_example"</span>)

<span class="co"># create custom file cache used by a future eddy</span>
cache &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cache_file.html">cache_file</a></span>(<span class="st">"cache_dir"</span>)

<span class="kw"><a href="../reference/new_eddy.html">new_eddy</a></span>(<span class="st">"custom_eddy"</span>,
         <span class="dt">cache =</span> cache)
<span class="kw"><a href="../reference/delete_eddy.html">delete_eddy</a></span>(<span class="st">"custom_eddy"</span>)</code></pre></div>
</div>
<div id="flow-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#flow-functions" class="anchor"></a>Flow functions</h2>
<p>Flow functions encapsulate the main functionality of the <code>rflow</code> package. They allow cacheing of function output and return a pre-computed result for a function called with the same arguments. Use cases of the flow functions are presented below</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rflow)

<span class="kw"><a href="../reference/use_eddy.html">use_eddy</a></span>(<span class="st">"rflow_examples"</span>)
<span class="co"># the usage of flow_fn is strongly recommended</span>
<span class="co"># it creates an implicit cache of a function and of the given flow call</span>
<span class="co"># Note that the arguments fn, fn_id and flow_options must be named</span>
<span class="co"># fn_id allows the user to suppress </span>
<span class="co"># console messages and  to explicitly indicate whether to reuse the old</span>
<span class="co"># cache or create a new one.</span>
fn1 &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) { x <span class="op">+</span><span class="st"> </span>y <span class="op">+</span><span class="st"> </span><span class="dv">1</span> }
flowed_fn &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flow_fn.html">flow_fn</a></span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dt">fn =</span> fn1)
<span class="co"># by passing the created flow to the collect function, the pre-computed</span>
<span class="co"># is obtained</span>
collected_result &lt;-<span class="st"> </span>flowed_fn <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="../reference/collect.R6Flow.html">collect</a></span>() <span class="co"># [1] 6</span>

<span class="co"># if th previously created function changes its body,</span>
<span class="co"># the flow object will update its state </span>
<span class="co"># when called again with the same arguments</span>
fn1 &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) { x <span class="op">+</span><span class="st"> </span>y }
flowed_fn &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flow_fn.html">flow_fn</a></span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dt">fn =</span> fn1)
<span class="co"># by passing the created flow to the collect function, the pre-computed</span>
<span class="co"># is obtained</span>
collected_result &lt;-<span class="st"> </span>flowed_fn <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="../reference/collect.R6Flow.html">collect</a></span>() <span class="co"># [1] 5</span>

<span class="co"># the flow object created previously can also be passed as argument to another </span>
<span class="co"># flow_fn fn function</span>
fn2 &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) { x <span class="op">*</span><span class="st"> </span>y }
collected_pipe_result &lt;-<span class="st"> </span>flowed_fn <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="../reference/flow_fn.html">flow_fn</a></span>(<span class="dv">2</span>, <span class="dt">fn =</span> fn2) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="../reference/collect.R6Flow.html">collect</a></span>() <span class="co"># [1] 10</span>

<span class="co"># make_flow_fn creates an explicit cache of a function. In order to use the </span>
<span class="co"># functionality of an R6flow object, the output of make_flow_fn has to be </span>
<span class="co"># collected first</span>
fn3 &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) { x <span class="op">+</span><span class="st"> </span>y <span class="op">+</span><span class="st"> </span><span class="dv">2</span> }
make_flow_function &lt;-<span class="st"> </span><span class="kw"><a href="../reference/make_flow_fn.html">make_flow_fn</a></span>(fn3)
rflow_function &lt;-<span class="st"> </span><span class="kw">make_flow_function</span>(<span class="dv">2</span>, <span class="dv">3</span>)
flow_result &lt;-<span class="st"> </span>rflow_function <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">        </span><span class="kw"><a href="../reference/collect.R6Flow.html">collect</a></span>() <span class="co"># [1] 7</span>

<span class="co"># usage with rflow pipes</span>
make_flow_function2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/make_flow_fn.html">make_flow_fn</a></span>(fn2)
collected_pipe_flow &lt;-<span class="st"> </span><span class="kw">make_flow_function</span>(<span class="dv">1</span>, <span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">make_flow_function2</span>(<span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="../reference/collect.R6Flow.html">collect</a></span>() <span class="co"># [1] 10</span>

<span class="co"># flow call creates an implicit cache of a function and of the given call.</span>
<span class="co"># it is not recommended to use it</span>
fn4 &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) { x <span class="op">+</span><span class="st"> </span>y <span class="op">+</span><span class="st"> </span><span class="dv">3</span> }
call_flow &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flow_call.html">flow_call</a></span>(<span class="kw">fn4</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">2</span>))
collected_result &lt;-<span class="st"> </span>call_flow <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                </span><span class="kw"><a href="../reference/collect.R6Flow.html">collect</a></span>() <span class="co"># [1] 6</span></code></pre></div>
</div>
<div id="flow-elements" class="section level2">
<h2 class="hasAnchor">
<a href="#flow-elements" class="anchor"></a>Flow elements</h2>
<p>A <code>R6Flow</code> element represents an object containing cache information regarding an element from a named list returned by a flowed function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rflow)

fn_list_output &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) { <span class="kw">list</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">Z =</span> <span class="dv">6</span>) }
flowed_fn &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flow_fn.html">flow_fn</a></span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dt">fn =</span> fn_list_output)  
flow_element &lt;-<span class="st"> </span><span class="kw"><a href="../reference/element.html">element</a></span>(flowed_fn, <span class="st">"x"</span>)

<span class="co"># the name of the element can be extracted by using the '[' selector </span>
<span class="co"># as presented below</span>
element_name &lt;-<span class="st"> </span>flowed_fn[<span class="st">"x"</span>]<span class="op">$</span>elem_name
<span class="co"># [1] "x"</span></code></pre></div>
</div>
<div id="flow-source-and-flow-sink" class="section level2">
<h2 class="hasAnchor">
<a href="#flow-source-and-flow-sink" class="anchor"></a>Flow source and flow sink</h2>
<p>The function <code>flow_source</code> creates a flow object that watches one or more files. This flow object does not throw an error if the <code>file_path</code> argument is missing, but it changes its state. Hece, it can be used to trigger a downstream flow object if the file is now present, changed or missing.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># write for the first time content in file and create flow</span>
file_temp &lt;-<span class="st"> </span><span class="kw">tempfile</span>(<span class="dt">pattern =</span> <span class="st">"example_source"</span>)
<span class="kw">write.csv</span>(<span class="kw">head</span>(mtcars), file_temp, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)
rflow_source &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flow_file_source.html">flow_file_source</a></span>(file_temp)
 
<span class="co"># write other content in the same file</span>
<span class="co"># now the flow object will update its state</span>
<span class="kw">write.csv</span>(<span class="kw">tail</span>(mtcars), file_temp, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)
rflow_source &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flow_file_source.html">flow_file_source</a></span>(file_temp)
<span class="kw">unlink</span>(file_temp)</code></pre></div>
<p>The function <code>flow_ns_sink</code> writes a value to a namespace only if the value has changed. The argument x represents the value to asign, the argument <code>var_name</code> represents the name (as a string) of the variable, <code>ns</code> is the namespace, either an <code>environment</code> or a <code>Shiny::reactiveValues</code> object. An example of how <code>flow_ns_sink</code> works with <code>R6flow</code> objects is presented below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fn &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) { x <span class="op">+</span><span class="st"> </span>y }
flowed_fn &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flow_fn.html">flow_fn</a></span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dt">fn =</span> fn)
sunk_flow &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flow_ns_sink.html">flow_ns_sink</a></span>(flowed_fn, <span class="st">"test_sink_flow"</span>, <span class="kw">new.env</span>()) </code></pre></div>
</div>
<div id="flow-for-data-frame-and-grouped-data-frame" class="section level2">
<h2 class="hasAnchor">
<a href="#flow-for-data-frame-and-grouped-data-frame" class="anchor"></a>Flow for data frame and grouped data frame</h2>
<p>The function <code>flow_dfr</code> performs row-wise caching of operations on data frame. Function <code>fn</code> operates on a data frame received as argument. <code>fn</code> will receive only the rows changed; it may drop some of the rows, but will not add any new rows. the function <code>fn</code> may return fewer or more columns or modify existing columns as long it always returns a consistent schema (i.e., the same column data types and names) for all calls. the data frame <code>df</code> passed to <code>fn</code> will include one additional column <code>..row_hash..</code> that must be returned as is in order to identify changes.</p>
<p>Arguments <code>fn</code>, <code>fn_id</code> and <code>flow_options</code>, when provided, must be named. Argument <code>fn</code> must be always provided.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rflow)
df_fn &lt;-<span class="st"> </span><span class="cf">function</span>(df, <span class="dt">i =</span> <span class="ot">NULL</span>) {
     <span class="cf">if</span> (<span class="kw">is.null</span>(i)) { 
         dfi &lt;-<span class="st"> </span>df
         dfi<span class="op">$</span>rm &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(dfi[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>])
    } <span class="cf">else</span> {
         dfi &lt;-<span class="st"> </span>df[i, , drop =<span class="st"> </span><span class="ot">FALSE</span>]
     }
     dfi
}

<span class="co"># the flow element can also become input for another flow_df function </span>
<span class="co"># in order to allow multiple, chained computations</span>
dfr_flow &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flow_dfr.html">flow_dfr</a></span>(mtcars, <span class="dv">1</span>, <span class="dt">fn =</span> df_fn)
collected_dfr &lt;-<span class="st"> </span>dfr_flow <span class="op">%&gt;%</span>
<span class="st">                 </span><span class="kw"><a href="../reference/collect.R6Flow.html">collect</a></span>()

<span class="co"># if one row of the dataframe changes, the R6Flow will change its state</span>
mtcars[<span class="dv">1</span>, <span class="st">"mpg"</span>] &lt;-<span class="st"> </span><span class="dv">22</span>
dfr_flow &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flow_dfr.html">flow_dfr</a></span>(mtcars, <span class="dv">1</span>, <span class="dt">fn =</span> df_fn)
collected_dfr &lt;-<span class="st"> </span>dfr_flow <span class="op">%&gt;%</span>
<span class="st">                </span><span class="kw"><a href="../reference/collect.R6Flow.html">collect</a></span>()</code></pre></div>
<p>The function <code>flow_dfg</code> performs group-wise cacheing operations on data frame Function <code>fn</code> will receive only the rows and groups changed; it may drop some of the rows, but will not add any new rows. The function <code>fn</code> may return fewer or more columns or modify existing columns as long it always returns a consistent schema (i.e., the same column data types and names) for all calls.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dfg_fn &lt;-<span class="st"> </span><span class="cf">function</span>(df) {
    df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span>
<span class="st">        </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">Sepal.Length =</span> Sepal.Length <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)
}

dfg_fn2 &lt;-<span class="st"> </span><span class="cf">function</span>(df) {
    df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span>
<span class="st">        </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">Petal.Length =</span> Petal.Length <span class="op">*</span><span class="st"> </span><span class="dv">3</span>)
}

iris &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(Species)
dfg_flow &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flow_dfg.html">flow_dfg</a></span>(iris, <span class="dt">fn =</span> dfg_fn)
collected_dfg &lt;-<span class="st"> </span>dfg_flow <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/collect.R6Flow.html">collect</a></span>()

<span class="co"># when a change in group is made, the flow object changes</span>
iris[<span class="dv">1</span>, <span class="st">"Species"</span>] &lt;-<span class="st"> "virginica"</span>
dfg_flow &lt;-<span class="st"> </span><span class="kw"><a href="../reference/flow_dfg.html">flow_dfg</a></span>(iris, <span class="dt">fn =</span> dfg_fn)
collected_dfg &lt;-<span class="st"> </span>dfg_flow <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/collect.R6Flow.html">collect</a></span>()

<span class="co"># the flow element can also become input for another flow_dfg function</span>
<span class="co"># in order to allow multiple, chained computations</span>
collected_dfg2 &lt;-<span class="st"> </span>dfg_flow <span class="op">%&gt;%</span>
<span class="st">   </span><span class="kw"><a href="../reference/flow_dfg.html">flow_dfg</a></span>(<span class="dt">fn =</span> dfg_fn2, <span class="dt">group_by =</span> <span class="st">"Species"</span>) <span class="op">%&gt;%</span>
<span class="st">   </span><span class="kw"><a href="../reference/collect.R6Flow.html">collect</a></span>()</code></pre></div>
</div>
<div id="shiny" class="section level2">
<h2 class="hasAnchor">
<a href="#shiny" class="anchor"></a>Shiny</h2>
<p>Shiny from RStudio uses reactive values to know what changes took place and what to recompute. It is thus possible to use a series of reactive elements in Shiny to prevent expensive re-computations from taking place.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(shiny)
<span class="kw">library</span>(rflow)
<span class="kw">library</span>(ggplot2)

mtcars2 &lt;-<span class="st"> </span>mtcars <span class="co"># copy of the original mtcars</span>
fn_add_mpg &lt;-<span class="st"> </span><span class="cf">function</span>(df, mpg) {
    df<span class="op">$</span>mpg &lt;-<span class="st"> </span>df<span class="op">$</span>mpg <span class="op">+</span><span class="st"> </span>mpg
    df
}
fn_add_cyl &lt;-<span class="st"> </span><span class="cf">function</span>(df, cyl) {
    df<span class="op">$</span>cyl &lt;-<span class="st"> </span>df<span class="op">$</span>cyl <span class="op">+</span><span class="st"> </span>cyl
    df
}

<span class="cf">if</span> (<span class="kw">interactive</span>()) {
    <span class="kw">options</span>(<span class="dt">device.ask.default =</span> <span class="ot">FALSE</span>)

    app &lt;-<span class="st"> </span><span class="kw">shinyApp</span>(
        <span class="dt">ui =</span> <span class="kw">fluidPage</span>(
            <span class="kw">numericInput</span>(<span class="st">"mpg"</span>, <span class="st">"mpg"</span>, <span class="dv">1</span>), <span class="co">#add mpg</span>
            <span class="kw">numericInput</span>(<span class="st">"cyl"</span>, <span class="st">"cyl"</span>, <span class="dv">2</span>), <span class="co">#add cyl</span>
            <span class="kw">plotOutput</span>(<span class="st">"mpg_vs_cyl"</span>)
        ),
        <span class="dt">server =</span> <span class="cf">function</span>(input, output) {
            rv_fn_add_mpg &lt;-<span class="st"> </span><span class="kw">reactive</span>({ <span class="co">#add mpg</span>
                <span class="co"># use two reactives in order to not re-calculate</span>
                <span class="co"># mtcars2 each time the input changes</span>
                <span class="kw">fn_add_mpg</span>(mtcars2, input<span class="op">$</span>mpg)
            })
            <span class="co"># it only changes when cyl changes its value</span>
            rv_fn_add_cyl &lt;-<span class="st"> </span><span class="kw">reactive</span>({
                <span class="kw">fn_add_cyl</span>(<span class="kw">rv_fn_add_mpg</span>(), input<span class="op">$</span>cyl)
            })
            rv_plot &lt;-<span class="st"> </span><span class="kw">reactive</span>({
                mtcars2 &lt;-<span class="st"> </span><span class="kw">rv_fn_add_cyl</span>()
                mtcars_plot &lt;-<span class="st"> </span>ggplot2<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(mtcars2, <span class="kw">aes</span>(<span class="dt">x =</span> cyl, <span class="dt">y =</span> mpg)) <span class="op">+</span>
<span class="st">                    </span>ggplot2<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>()
                mtcars_plot
            })
            output<span class="op">$</span>mpg_vs_cyl &lt;-<span class="st"> </span><span class="kw">renderPlot</span>(<span class="kw">rv_plot</span>())
        }
    )

    <span class="kw">runApp</span>(app)
}</code></pre></div>
<p>The downside is that we need one reactive element for each function in the pipeline - this makes data processing dependent on UI / Shiny. Using <code>rflow</code>, we can separate the UI from the data processing, maintaining the caching not only for the current state but for all previously computed states.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(shiny)
<span class="kw">library</span>(rflow)
<span class="kw">library</span>(ggplot2)

mtcars2 &lt;-<span class="st"> </span>mtcars <span class="co"># copy of the original mtcars</span>
fn_add_mpg &lt;-<span class="st"> </span><span class="cf">function</span>(df, mpg) {
    df<span class="op">$</span>mpg &lt;-<span class="st"> </span>df<span class="op">$</span>mpg <span class="op">+</span><span class="st"> </span>mpg
    df
}
fn_add_cyl &lt;-<span class="st"> </span><span class="cf">function</span>(df, cyl) {
    df<span class="op">$</span>cyl &lt;-<span class="st"> </span>df<span class="op">$</span>cyl <span class="op">+</span><span class="st"> </span>cyl
    df
}

<span class="cf">if</span> (<span class="kw">interactive</span>()) {
    <span class="kw">options</span>(<span class="dt">device.ask.default =</span> <span class="ot">FALSE</span>)
    
    app &lt;-<span class="st"> </span><span class="kw">shinyApp</span>(
        <span class="dt">ui =</span> <span class="kw">fluidPage</span>(
            <span class="kw">numericInput</span>(<span class="st">"mpg"</span>, <span class="st">"mpg"</span>, <span class="dv">1</span>), <span class="co">#add mpg</span>
            <span class="kw">numericInput</span>(<span class="st">"cyl"</span>, <span class="st">"cyl"</span>, <span class="dv">2</span>), <span class="co">#add cyl</span>
            <span class="kw">plotOutput</span>(<span class="st">"mpg_vs_cyl"</span>)
        ),
        <span class="dt">server =</span> <span class="cf">function</span>(input, output) {
            <span class="co"># reacts to both mpg and cyl changes simultaneously but if nothing </span>
            <span class="co"># has changed, the function result is taken from cache. </span>
            <span class="co"># If only one value has changed, that value will be recalculated</span>
            
            rv_plot &lt;-<span class="st"> </span><span class="kw">reactive</span>({
                mtcars2 &lt;-<span class="st"> </span>mtcars2 <span class="op">%&gt;%</span>
<span class="st">                    </span><span class="kw"><a href="../reference/flow_fn.html">flow_fn</a></span>(input<span class="op">$</span>mpg, <span class="dt">fn =</span> fn_add_mpg) <span class="op">%&gt;%</span>
<span class="st">                    </span><span class="kw"><a href="../reference/flow_fn.html">flow_fn</a></span>(input<span class="op">$</span>cyl, <span class="dt">fn =</span> fn_add_cyl) <span class="op">%&gt;%</span>
<span class="st">                    </span><span class="kw"><a href="../reference/collect.R6Flow.html">collect</a></span>() 
                mtcars_plot &lt;-<span class="st"> </span>ggplot2<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(mtcars2, <span class="kw">aes</span>(<span class="dt">x =</span> cyl, <span class="dt">y =</span> mpg)) <span class="op">+</span>
<span class="st">                    </span>ggplot2<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>()
                mtcars_plot
            })
            output<span class="op">$</span>mpg_vs_cyl &lt;-<span class="st"> </span><span class="kw">renderPlot</span>(<span class="kw">rv_plot</span>())
        }
    )
    
    <span class="kw">runApp</span>(app)
}</code></pre></div>
<p>While a similar workflow can be achieved with package <code>memoise</code>, it suffers from several disadvantages (below).</p>
</div>
<div id="memoise" class="section level2">
<h2 class="hasAnchor">
<a href="#memoise" class="anchor"></a>Memoise</h2>
<p>Package <a href="https://github.com/r-lib/memoise">memoise</a> by Hadley Wickham, Jim Hester and others was the main source of inspiration. Memoise is elegant, fast, simple to use, but it suffers from certain limitations that we hope to overcome in this package:</p>
<ul>
<li>excessive <a href="https://github.com/r-lib/memoise/issues/31">rehashing of inputs</a>
</li>
<li>only one cache layer (although its cache framework is extensible)</li>
<li>no input/output sub-setting, it uses the complete set of arguments provided</li>
<li>no reactivity (yet to be implemented in <code>rflow</code>)</li>
</ul>
</div>
<div id="drake" class="section level2">
<h2 class="hasAnchor">
<a href="#drake" class="anchor"></a>Drake</h2>
<p>Package <a href="https://github.com/ropensci/drake">drake</a> by Will Landau and others provides a complete framework for large data sets, including using files as inputs and outputs. The downside is that it requires additional overhead to get started and its focus is on the pipeline as a whole. If your work requires many hours of computations (which increases the value of each result), the overhead due to the setup has a relatively lower cost - in this scenario <code>drake</code> is an excellent choice.</p>
</div>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<p>Package <code>rflow</code> is somewhere between <code>memoise</code> and <code>drake</code>:</p>
<ul>
<li>one can start using <code>rflow</code> right away, with minimal overhead</li>
<li>allows focusing on the data processing (e.g., EDA) and not on the framework</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#problems-addressed-by-rflow">Problems addressed by rflow</a></li>
      <li><a href="#basics">Basics</a></li>
      <li><a href="#eddy-functions">Eddy functions</a></li>
      <li><a href="#flow-functions">Flow functions</a></li>
      <li><a href="#flow-elements">Flow elements</a></li>
      <li><a href="#flow-source-and-flow-sink">Flow source and flow sink</a></li>
      <li><a href="#flow-for-data-frame-and-grouped-data-frame">Flow for data frame and grouped data frame</a></li>
      <li><a href="#shiny">Shiny</a></li>
      <li><a href="#memoise">Memoise</a></li>
      <li><a href="#drake">Drake</a></li>
      <li><a href="#summary">Summary</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Mike Badescu, Ana-Maria Niculescu, Teodor Ciuraru.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
